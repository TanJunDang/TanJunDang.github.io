<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Build a better app.">
    

    <!--Author-->
    
        <meta name="author" content="TanJunDang">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="ListView的理解"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="TanJunDang"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="undefined"/>
    

    <!-- Title -->
    
    <title>ListView的理解 - TanJunDang</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!--Favicon-->
    

</head>

<body>

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">TanJunDang</a>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives">Archives</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
            
                <li><a href="https://www.facebook.com/" class="fb" target="_blank" data-title="Facebook"></a></li>
            
            
                <li><a href="https://www.behance.net/" class="behance" target="_blank" data-title="Behance"></a></li>
            
            
                <li><a href="https://plus.google.com/+Pixelhint/posts" class="google" target="_blank" data-title="Google+"></a></li>
            
            
                <li><a href="https://dribbble.com/pixelhint" class="dribble" target="_blank" data-title="Dribble"></a></li>
            
            
            
            
        </ul><!-- end social -->

        <div class="rights">
            <p>Copyright © 2014 magnetic.</p>
            <p>Template by <a href="http://pixelhint.com/magnetic-free-html5-responsive-photography-website-template/">Pixelhint.com</a></p>
            <p>Hexo Theme by <a href="http://www.codeblocq.com/">Jonathan K.</a></p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('http://placehold.it/1300x500');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a href="/2015/09/08/Git/" class="previous" data-title="Git的学习"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a href="/2015/09/01/Canvas/" class="next" data-title="Canvas笔记"></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">ListView的理解</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h1 id="ListView的基本使用"><a href="#ListView的基本使用" class="headerlink" title="ListView的基本使用"></a>ListView的基本使用</h1><h2 id="ListView-分割线"><a href="#ListView-分割线" class="headerlink" title="ListView 分割线"></a>ListView 分割线</h2><blockquote>
<p>在divider 为颜色 时 需设置dividerHeight</p>
</blockquote>
<h3 id="如何取消分割线"><a href="#如何取消分割线" class="headerlink" title="如何取消分割线"></a>如何取消分割线</h3><blockquote>
<p>在java中取消  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">listView.setDividerHeight(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">listView.setDivider(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<blockquote>
<p>在XML布局文件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android:divider=<span class="string">"#FFCC00"</span>  </span><br><span class="line"></span><br><span class="line">或	  </span><br><span class="line"></span><br><span class="line">android:divider=<span class="string">"@null"</span></span><br></pre></td></tr></table></figure>
<h2 id="设置listview无点击背景效果"><a href="#设置listview无点击背景效果" class="headerlink" title="设置listview无点击背景效果"></a>设置listview无点击背景效果</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:listSelector=<span class="string">"@android:color/transparent"</span></span><br></pre></td></tr></table></figure>
<h2 id="如何判断listview是最后一个"><a href="#如何判断listview是最后一个" class="headerlink" title="如何判断listview是最后一个"></a>如何判断listview是最后一个</h2><blockquote>
<p>if(坐标&lt;总长度-1)</p>
</blockquote>
<h2 id="ConvertView的理解"><a href="#ConvertView的理解" class="headerlink" title="ConvertView的理解"></a>ConvertView的理解</h2><blockquote>
<p>每一个条目（Item）的显示，都是ListView加载布局来实现的。<br>convertview就是滑出屏幕后被Android回收的条目。</p>
</blockquote>
<p>原因：由于每次加载布局会使性能下降，所以应该复用convertview。  </p>
<p>如何复用？ 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(convertView==<span class="keyword">null</span>)&#123;</span><br><span class="line">	加载布局</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//然后获取布局里的的View设置相关的值  </span></span><br><span class="line">convertView.findViewById(R.id.text)).setText(DATA[position]);</span><br></pre></td></tr></table></figure>
<p>由于每次都要FindId，这样也会使性能下降。所以我们应该复用ConvertView，这时就用到ViewHolder跟settag跟gettag方法了。</p>
<blockquote>
<p>简单来说ViewHolder就是对一个布局里的控件FindId</p>
</blockquote>
<p>所以代码改成这样：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ViewHolder holder;</span><br><span class="line"><span class="keyword">if</span>(convertView==<span class="keyword">null</span>)&#123;</span><br><span class="line">	加载布局</span><br><span class="line">	holder =  <span class="keyword">new</span> ViewHolder();</span><br><span class="line">	holder.tvName = convertView.findViewById();  </span><br><span class="line">	convertView.setTag(holder);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//然后获取布局里的的View设置相关的值  </span></span><br><span class="line"></span><br><span class="line">	.</span><br><span class="line">	.</span><br><span class="line">	.</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> TextView tvName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ListView置于底部的问题"><a href="#ListView置于底部的问题" class="headerlink" title="ListView置于底部的问题"></a>ListView置于底部的问题</h2><blockquote>
<p>目标效果<br>ListView位于底部，listview自适应  </p>
<p>实际情况<br>RelativeLayout的设置layout_alignParentBottom，高度自适应,listview设置高度自适应，结果是ListView填满屏幕。如果RelativeLayout高度为固定值，则可以实现上述效果。因此需要动态修改RelativeLayout的高度来实现。</p>
<p>解决方法<br>当数据长度小于半屏时,计算</p>
</blockquote>
<p><img src="http://imglf2.nosdn.127.net/img/ZFRpZXBrMUVQR0JyWk9UTWZQSHhuejFjZ3VKUktqQ1dUT016Z1RIUFNhU1NFS3lRaXNGVjdBPT0.png?imageView&amp;thumbnail=250x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg" alt=""></p>
<p><a href="http://blog.csdn.net/id19870510/article/details/6408654" target="_blank" rel="external">alignParentBottom参考</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拨打电话功能</span></span><br><span class="line"><span class="keyword">if</span> (isFirshLoad &amp;&amp; menuHeight &lt; (Functions.getScreenHeightPix(<span class="keyword">this</span>) / <span class="number">2</span>)) &#123;</span><br><span class="line">		RelativeLayout.LayoutParams lp = (RelativeLayout.LayoutParams) phoneView.getLayoutParams();</span><br><span class="line">		lp.height = menuHeight;</span><br><span class="line">		phoneView.setLayoutParams(lp);</span><br><span class="line">		isFirshLoad = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ListView的下拉刷新，上拉加载数据"><a href="#ListView的下拉刷新，上拉加载数据" class="headerlink" title="ListView的下拉刷新，上拉加载数据"></a>ListView的下拉刷新，上拉加载数据</h2><h3 id="Listview使用的基本流程"><a href="#Listview使用的基本流程" class="headerlink" title="Listview使用的基本流程"></a>Listview使用的基本流程</h3><p><img src="http://imglf.nosdn.127.net/img/ZFRpZXBrMUVQR0RPUGxTaitJaWdwenM5R1V3S3NZM0pJY1hFUVVxOWg2NFZsRjB0Z1dQRUp3PT0.jpg?imageView&amp;thumbnail=500x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg%7Cwatermark&amp;type=2&amp;text=wqkgVGFuSnVuRGFuZyAvIHRhbmp1bmRhbmcubG9mdGVyLmNvbQ==&amp;font=bXN5aA==&amp;gravity=southwest&amp;dissolve=30&amp;fontsize=240&amp;dx=8&amp;dy=10&amp;stripmeta=0" alt=""></p>
<h3 id="加载更多的逻辑判断"><a href="#加载更多的逻辑判断" class="headerlink" title="加载更多的逻辑判断"></a>加载更多的逻辑判断</h3><blockquote>
<p>加载更多的条件<br>本地list的长度小于服务器下发的总数量</p>
<p>判断是否滑动到底部<br>mListView.getLastVisiblePosition() == mListView.getAdapter().getCount() - 1</p>
<p>判断最后一项是否完全显示(需要滑动到底部的判断)<br>mListView.getChildAt(mListView.getChildCount() - 1).getBottom() &lt;= mListView.getBottom())</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">listView.setOnScrollListener(<span class="keyword">new</span> AbsListView.OnScrollListener() &#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(AbsListView view, <span class="keyword">int</span> scrollState)</span> </span>&#123;</span><br><span class="line">			<span class="comment">// SCROLL_STATE_IDLE是当屏幕停止滚动时</span></span><br><span class="line">			<span class="comment">// SCROLL_STATE_TOUCH_SCROLL是当用户在以触屏方式滚动屏幕并且手指仍然还在屏幕上时（The user is scrolling using touch, and their finger is still on the screen）</span></span><br><span class="line">			<span class="comment">// SCROLL_STATE_FLING是当用户由于之前划动屏幕并抬起手指，屏幕产生惯性滑动时</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScroll</span><span class="params">(AbsListView view, <span class="keyword">int</span> firstVisibleItem, <span class="keyword">int</span> visibleItemCount, <span class="keyword">int</span> totalItemCount)</span></span><br><span class="line">			<span class="comment">// firstVisibleItem 表示在当前屏幕显示的第一个listItem在整个listView里面的位置（下标从0开始）  </span></span><br><span class="line">			<span class="comment">// visibleItemCount表示在现时屏幕可以见到的ListItem(部分显示的ListItem也算)总数  </span></span><br><span class="line">			<span class="comment">// totalItemCount表示ListView的ListItem总数   </span></span><br><span class="line">			<span class="comment">// listView.getLastVisiblePosition()表示在现时屏幕最后一个ListItem</span></span><br><span class="line">			<span class="comment">// firstVisibleItem + visibleItemCount == totalItemCount；滑动到底部</span></span><br><span class="line">			<span class="comment">// firstVisibleItem + visibleItemCount &gt;= totalItemCount; 滑动到底部，大于表示可以加载更多，</span></span><br><span class="line"></span><br><span class="line">				<span class="title">if</span> <span class="params">(firstVisibleItem + visibleItemCount &gt;= totalItemCount &amp;&amp; isLastitemAbsolutelyVisible(view, totalItemCount)</span>) </span>&#123;</span><br><span class="line">				<span class="comment">// 滑动到底部且最后一项完全显示</span></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断最后一项是否完全显示</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLastitemAbsolutelyVisible</span><span class="params">(AbsListView view, <span class="keyword">int</span> totalItemCount)</span> </span>&#123;</span><br><span class="line">		 <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line">		<span class="comment">//  判断是否到达底部</span></span><br><span class="line">		 <span class="keyword">if</span> ((totalItemCount &gt; <span class="number">0</span>) &amp;&amp; (view.getLastVisiblePosition() == totalItemCount - <span class="number">1</span>)) &#123;</span><br><span class="line">			<span class="comment">//  判断是否完全显示</span></span><br><span class="line">				 <span class="keyword">if</span> (view.getBottom() == view.getChildAt(view.getChildCount() - <span class="number">1</span>).getBottom()) &#123;</span><br><span class="line">						 result = <span class="keyword">true</span>;</span><br><span class="line">				 &#125;</span><br><span class="line">		 &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				 result = <span class="keyword">false</span>;</span><br><span class="line">		 &#125;</span><br><span class="line">		 <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><blockquote>
<p>下发后的json,转成对象后,集合一定要判断是否为空。<br>需要做出错处理,例如没数据，请求失败等情况。<br>notifyDataSetChanged方法正常使用的前提是数据源ID没变。//setAdapter会改变。</p>
</blockquote>
<p>在跟服务器交互时  </p>
<blockquote>
<p>1.当ListView 下拉时，<font color="red">清空原数据</font>,请求新的一页数据,需要将原来的数据清空。<br>2.当Listview 上拉时，重新加载一页数据。 currentPage ++; //有些API是根据偏移量来计算的,所以偏移量需要加上每页的长度才可实现翻页。即offset+=pagesize;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">srlExp.setOnRefreshListener(<span class="keyword">new</span> SwipeRefreshLayout.OnRefreshListener() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          currentPage = <span class="number">1</span>;</span><br><span class="line">          getData(); <span class="comment">//向服务器请求数据</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  srlExp.setOnLoadListener(<span class="keyword">new</span> RefreshLoadLayout.OnLoadListener() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoad</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          currentPage++; <span class="comment">//offset+=pagesize;</span></span><br><span class="line">          getData();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>3.处理服务器获得的数据</p>
<p>步骤<br>1.判断是否要清空原数据。</p>
<p>2.<strong>将服务端的数据加入到list中，然后更新adapter。</strong>（用list.addAll()方法）</p>
<p>3.(adapter更新之后)通过服务器下发总条数跟当前list的长度对比，设置是否有加载更多数据。</p>
<h2 id="4-最后设置refresh、loading为false"><a href="#4-最后设置refresh、loading为false" class="headerlink" title="4.最后设置refresh、loading为false"></a>4.最后设置refresh、loading为false</h2></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGeneralSuccess</span><span class="params">(String result, <span class="keyword">long</span> flag)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (flag == reqFlagAchieve) &#123;</span><br><span class="line">        achieveResp = GsonTool.getServerBean(result, AchieveResp.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (achieveResp.isSuccess()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (achieveResp.getAchievelist() != <span class="keyword">null</span>) &#123;<span class="comment">//一定要判断数据是否为null</span></span><br><span class="line"></span><br><span class="line">                srlShare.setVisibility(View.VISIBLE);<span class="comment">//refreshLayout显示</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (currentPage == <span class="number">1</span>) &#123;<span class="comment">//获取最新一页数据时,需要清空原有数据</span></span><br><span class="line">                    list.clear();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                amount = achieveResp.getAmount();<span class="comment">//获取服务器下发数据总长度</span></span><br><span class="line"></span><br><span class="line">                list.addAll(achieveResp.getAchievelist());<span class="comment">//加入全部数据</span></span><br><span class="line">                achieveShareAdapter.notifyDataSetChanged();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (list.size() &lt; amount) &#123;<span class="comment">//判断是否有加载更多</span></span><br><span class="line">                    srlShare.setLoadMoreEnable(<span class="keyword">true</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    srlShare.setLoadMoreEnable(<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Functions.toast(<span class="keyword">this</span>, getString(R.string.common_hint_server_error));</span><br><span class="line">        rvShare.showFailed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    srlShare.setRefreshing(<span class="keyword">false</span>);	<span class="comment">//设置停止刷新（ProgressBar消失）</span></span><br><span class="line">    srlShare.setLoading(<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="listview点击item选中的实现"><a href="#listview点击item选中的实现" class="headerlink" title="listview点击item选中的实现"></a>listview点击item选中的实现</h2><blockquote>
<p>在Adapter定义一个类方法setSelectedItem,用于接收点击的item。<br>外部listiview点击事件中调用上述方法即可。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setSelectedItem</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">selectedItem = pos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; adapterView, View view, <span class="keyword">int</span> i,<span class="keyword">long</span> l)</span> </span>&#123;    </span><br><span class="line">mySchoolAdapter.setSelectedItem(i);<span class="comment">//用于设置adapter的点击项</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//getView下面重写 使其 点击选中修改背景</span></span><br><span class="line"><span class="keyword">if</span> (i == selectedItem) &#123;</span><br><span class="line">    holder.tvSchool.setTextColor(context.getResources().getColor(R.color.common_system_style_red));</span><br><span class="line">    holder.rlRoot.setBackgroundColor(context.getResources().getColor(R.color.white));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    holder.tvSchool.setTextColor(context.getResources().getColor(R.color.white));</span><br><span class="line">    holder.rlRoot.setBackgroundColor(context.getResources().getColor(R.color.common_system_style_red));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ListView的Item点击传递对象"><a href="#ListView的Item点击传递对象" class="headerlink" title="ListView的Item点击传递对象"></a>ListView的Item点击传递对象</h2><blockquote>
<p>Adapter 的getItem返回集合的对象 可以在getView里重用,将点击的数据传递给下一个activity</p>
</blockquote>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> AgencyInfo modifyInfo;<span class="comment">//待修改的info</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> AgencyInfo <span class="title">getItem</span><span class="params">(position)</span></span>&#123; <span class="comment">//将Object改成实际的对象</span></span><br><span class="line"><span class="keyword">return</span> list.get(position);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">getView</span><span class="params">(....)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> tag = <span class="number">1</span>; <span class="comment">//定义一个tag 用于获取相关的数据</span></span><br><span class="line"></span><br><span class="line">AgencyInfo info = getItem(position);</span><br><span class="line"></span><br><span class="line">convertView.setonClickListener(....)&#123;</span><br><span class="line">AgencyInfo msg = v.getTag(tag);<span class="comment">//之后便可以将msg对象传给下一个Activity</span></span><br><span class="line">modifyInfo=msg;<span class="comment">//全局变量缓存当前选中的item</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">convertView.setTag(tag,info);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent intentData)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (requestCode == XXX &amp;&amp; resultCode == RESULT_OK) &#123;</span><br><span class="line">	  AgencyInfo data = (AgencyInfo) intentData.getSerializableExtra(XXX);</span><br><span class="line">		modifyInfo.setName(data.getName());</span><br><span class="line">		mAdapter.notifyDataSetChanged();</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>总结<br>重写getItem方法、getView设置tag<br>通过setTag设置对象、通过getTag获取对象</p>
</blockquote>
<h2 id="ListView中数据混乱的问题"><a href="#ListView中数据混乱的问题" class="headerlink" title="ListView中数据混乱的问题"></a>ListView中数据混乱的问题</h2><p><img src="http://imglf2.nosdn.127.net/img/ZFRpZXBrMUVQR0NkTklDWU42ajNFVmwvWExtTWdzL082ZHd0Q2plMGw0eENOcndNMUp5bHpnPT0.gif" alt=""></p>
<blockquote>
<p>如图所示<br>第一个Item跟翻页后的第一个Item重复。<br>原因<br>ConvertView复用旧的View导致数据混乱。<br>第一个Item把所有View显示出来，导致复用的Item也显示了所有View。<br>解决办法<br>getView方法中设置数据时使用if - else语句。<br>getView方法中添加把所有VIew都关闭显示的代码，根据需要显示出来。<br>解析<br>上述示例默认打开上班1、上班2两个布局。所以复用的Item也显示了上班1、上班2.</p>
</blockquote>
<h2 id="ScrollView嵌套ListView"><a href="#ScrollView嵌套ListView" class="headerlink" title="ScrollView嵌套ListView"></a>ScrollView嵌套ListView</h2><blockquote>
<p>现象<br>listview只显示一行<br>解决方法<br>重新计算listview高度</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setListViewHeightBasedOnChildren</span><span class="params">(ListView listView)</span> </span>&#123;</span><br><span class="line">			 <span class="keyword">if</span> (listView == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">			 ListAdapter listAdapter = listView.getAdapter();</span><br><span class="line">			 <span class="keyword">if</span> (listAdapter == <span class="keyword">null</span>) &#123;</span><br><span class="line">					 <span class="comment">// pre-condition</span></span><br><span class="line">					 <span class="keyword">return</span>;</span><br><span class="line">			 &#125;</span><br><span class="line">			 <span class="keyword">int</span> totalHeight = <span class="number">0</span>;</span><br><span class="line">			 <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; listAdapter.getCount(); i++) &#123;</span><br><span class="line">					 View listItem = listAdapter.getView(i, <span class="keyword">null</span>, listView);</span><br><span class="line">					 listItem.measure(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">					 totalHeight += listItem.getMeasuredHeight();</span><br><span class="line">			 &#125;</span><br><span class="line">			 ViewGroup.LayoutParams params = listView.getLayoutParams();</span><br><span class="line">			 params.height = totalHeight + (listView.getDividerHeight() * (listAdapter.getCount() - <span class="number">1</span>));</span><br><span class="line">			 listView.setLayoutParams(params);</span><br><span class="line">	 &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ListView-wrap-content无效"><a href="#ListView-wrap-content无效" class="headerlink" title="ListView wrap_content无效"></a>ListView wrap_content无效</h2><blockquote>
<p>原因<br>wrap_content是根据子View来决定自身的宽高，但是listview的子View是不确定的，所以wrap_content无效。<br>解决方法添加LinearLayout、FrameLayout<br>父布局必须为match_parent，设置weightSum</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">			android:id="@+id/llSoundLayout"</span><br><span class="line">			android:layout_width="match_parent"</span><br><span class="line">			android:layout_height="wrap_content"</span><br><span class="line">			android:layout_below="@id/llInfo"</span><br><span class="line">			android:background="@color/common_divider_red"</span><br><span class="line">			android:orientation="horizontal"</span><br><span class="line">			android:weightSum="1"</span><br><span class="line">			android:visibility="gone"&gt;</span><br><span class="line"></span><br><span class="line">			&lt;ListView</span><br><span class="line">					android:id="@+id/listView"</span><br><span class="line">					android:layout_width="0dp"</span><br><span class="line">					android:layout_height="wrap_content"</span><br><span class="line">					android:layout_weight="0.4"</span><br><span class="line">					android:background="@color/black"</span><br><span class="line">					android:divider="@null"</span><br><span class="line">					android:gravity="center"</span><br><span class="line">					android:horizontalSpacing="7dp"</span><br><span class="line">					android:numColumns="4"</span><br><span class="line">					android:scrollbars="none"&gt;&lt;/ListView&gt;</span><br><span class="line"></span><br><span class="line">			&lt;FrameLayout</span><br><span class="line">					android:layout_width="0dp"</span><br><span class="line">					android:layout_height="match_parent"</span><br><span class="line">					android:layout_weight="0.6"</span><br><span class="line">					android:background="@color/com_facebook_blue" /&gt;</span><br><span class="line"></span><br><span class="line">	&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<h2 id="嵌套ListView实例"><a href="#嵌套ListView实例" class="headerlink" title="嵌套ListView实例"></a>嵌套ListView实例</h2><p><img src="http://imglf1.nosdn.127.net/img/ZFRpZXBrMUVQR0NXTko3QXc0VjEwRFFnSXo0UFlzSFQ4MC92ZkZtSHNNRWtDbkpPQ0gyQVVRPT0.png?imageView&amp;thumbnail=250x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg" alt=""></p>
<blockquote>
<p>可以通过ExpandableListView来实现上述需求。</p>
</blockquote>
<h1 id="ExpandableListView"><a href="#ExpandableListView" class="headerlink" title="ExpandableListView"></a>ExpandableListView</h1><p><img src="http://imglf1.nosdn.127.net/img/U05xRllGZk4zNU04eWZsUCszL244ZXhqMDBIOS81Sm1vT08vQWQvRG1CTTIzUWFPbDI4eGVRPT0.png?imageView&amp;thumbnail=200x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg" alt=""></p>
<h2 id="关闭箭头"><a href="#关闭箭头" class="headerlink" title="关闭箭头"></a>关闭箭头</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elvMsg.setGroupIndicator(<span class="keyword">null</span>); <span class="comment">//箭头置空</span></span><br></pre></td></tr></table></figure>
<h2 id="默认展开-通过setOnGroup设置，返回false为不展开，true为展开"><a href="#默认展开-通过setOnGroup设置，返回false为不展开，true为展开" class="headerlink" title="默认展开(通过setOnGroup设置，返回false为不展开，true为展开)"></a>默认展开(通过setOnGroup设置，返回false为不展开，true为展开)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">elvMsg.setOnGroupClickListener(<span class="keyword">new</span> ExpandableListView.OnGroupClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onGroupClick</span><span class="params">(ExpandableListView parent, View v, <span class="keyword">int</span> groupPosition, <span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>; <span class="comment">//默认展开</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>自定义ExpandleableListView箭头及其位置</p>
<p>用android:groupIndicator属性自定义箭头？你会发现该属性有毒,而且不能改变其位置。</p>
</blockquote>
<p><img src="http://imglf1.nosdn.127.net/img/U05xRllGZk4zNU8xek1qd3RZTE95QmRHeG1vTksydnJIMXkvQVVSalMwMFFmNWcrRFpIVW93PT0.png?imageView&amp;thumbnail=250x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg" alt=""></p>
<blockquote>
<p>那是不是就不能自定义箭头的图标以及位置了呢？答案是否定的。</p>
</blockquote>
<p><img src="http://www.runoob.com/wp-content/uploads/2015/11/16908438.jpg" alt=""></p>
<blockquote>
<p>直接在parent的布局item里添加一个ImageView即可。利用getview的isExpandable来进行更改图片即可。</p>
</blockquote>
<h2 id="设置父布局跟子布局的Divider"><a href="#设置父布局跟子布局的Divider" class="headerlink" title="设置父布局跟子布局的Divider"></a>设置父布局跟子布局的Divider</h2><blockquote>
<p>在ExpandableListView的属性里有dividerHeight、childDivider、divider三个属性。当你设置了divider的高度时，父跟子的divider的高度都是统一由该属性控制的。所以我们要根据需求来设置divider。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">android:dividerHeight=<span class="string">""</span> <span class="comment">//控制父、子divider的高度</span></span><br><span class="line">android:childDivider=<span class="string">""</span></span><br><span class="line">android:divider=<span class="string">""</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>1.父布局不要Divider，子布局需要Divider。在xml文件中不设置任何divider属性，在子布局中添加一个View，用于充当divider。当position==0时，关闭显示。<br>2.父布局需要divider，子布局需要divider</p>
</blockquote>
<p><a href="http://mushuichuan.com/2016/04/13/expandablelistview/" target="_blank" rel="external">参考</a></p>


            <!-- Tags -->
            


<div class="tags">
    <a href="/tags/ListView的理解/">ListView的理解</a>
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>
</section><!-- end main -->

<!-- After footer scripts -->

<!-- jQuery -->
<script src="/js/jquery.js"></script>

<!-- Custom Code -->
<script src="/js/main.js"></script>

<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>