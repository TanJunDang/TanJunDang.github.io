<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Build a better app.">
    

    <!--Author-->
    
        <meta name="author" content="TanJunDang">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Preference的使用"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="TanJunDang"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="undefined"/>
    

    <!-- Title -->
    
    <title>Preference的使用 - TanJunDang</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!--Favicon-->
    

</head>

<body>

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">TanJunDang</a>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives">Archives</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
            
                <li><a href="https://www.facebook.com/" class="fb" target="_blank" data-title="Facebook"></a></li>
            
            
                <li><a href="https://www.behance.net/" class="behance" target="_blank" data-title="Behance"></a></li>
            
            
                <li><a href="https://plus.google.com/+Pixelhint/posts" class="google" target="_blank" data-title="Google+"></a></li>
            
            
                <li><a href="https://dribbble.com/pixelhint" class="dribble" target="_blank" data-title="Dribble"></a></li>
            
            
            
            
        </ul><!-- end social -->

        <div class="rights">
            <p>Copyright © 2014 magnetic.</p>
            <p>Template by <a href="http://pixelhint.com/magnetic-free-html5-responsive-photography-website-template/">Pixelhint.com</a></p>
            <p>Hexo Theme by <a href="http://www.codeblocq.com/">Jonathan K.</a></p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('http://placehold.it/1300x500');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a href="/2016/09/14/ToolBar/" class="previous" data-title="Toolbar笔记"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a href="/2016/09/01/DialogFragment/" class="next" data-title="DialogFragment笔记"></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">Preference的使用</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h1 id="Preference的基础知识"><a href="#Preference的基础知识" class="headerlink" title="Preference的基础知识"></a>Preference的基础知识</h1><p><img src="http://imglf2.nosdn.127.net/img/ZFRpZXBrMUVQR0M0WDB6Y2NDQ2xZbDl0YVkzTkE3bndsWWJTUjJuWjA3OEpORE1KWFNueFp3PT0.png?imageView&amp;thumbnail=500x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg" alt=""></p>
<a id="more"></a>
<blockquote>
<p>理解<br>1.Preference用于构建与系统一致的设置页面。<br>2.Preference的使用跟普通的View布局没有多大的区别，新建xml布局时，首先根标签PreferenceScreen相当于RelativeLayout，PreferenceCategory相当于第二层Viewgroup，Preference相当于View。<br>3.使用Preference Headers可以使Preference在大屏设备中分屏显示(需要继承PreferenceActivity)。</p>
</blockquote>
<p><img src="http://imglf0.nosdn.127.net/img/ZFRpZXBrMUVQR0F3blNCN2NqcWhnY3Vybk0yRWE0NElVYUtLVVF3VFVBMlVUUGNTM0Y1b2dnPT0.png?imageView&amp;thumbnail=500x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg" alt=""></p>
<p><img src="http://imglf2.nosdn.127.net/img/ZFRpZXBrMUVQR0F3blNCN2NqcWhnY3Vybk0yRWE0NElJZU5UQW1MT1JIMFY3dmQ2NG1mQ1VnPT0.png?imageView&amp;thumbnail=500x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg" alt=""></p>
<blockquote>
<p>使用步骤<br>1.在res目录新建一个xml目录，创建xml文件。<br>2.以PreferenceScreen为根标签，然后根据需要创建PreferenceCategory，接着创建各种Preference。<br>3.创建Fragment，继承PreferenceFragment，重写onCreate方法，通过addPreferencesFromResource方法加载xml布局。<br>4.通过findPreference方法来FindID；</p>
</blockquote>
<h3 id="示例-嵌套PreferenceScreen-基础"><a href="#示例-嵌套PreferenceScreen-基础" class="headerlink" title="示例 - 嵌套PreferenceScreen(基础)"></a>示例 - 嵌套PreferenceScreen(基础)</h3><blockquote>
<p>效果</p>
</blockquote>
<p><img src="http://imglf1.nosdn.127.net/img/ZFRpZXBrMUVQR0NONXlFYmNadVlKSlNWU0FrZU5FcXhzK2RQYkdCY1dnOGhCSVJmdy9YdWNBPT0.png?imageView&amp;thumbnail=300x0&amp;quality=96&amp;stripmeta=0&amp;type=jpg" alt=""></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 创建xml布局文件，代码如下 --&gt;</span></span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">PreferenceScreen</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">PreferenceCategory</span> <span class="attr">android:title</span>=<span class="string">"常用设置"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Preference</span></span><br><span class="line">            <span class="attr">android:key</span>=<span class="string">"clearCache"</span></span><br><span class="line">            <span class="attr">android:summary</span>=<span class="string">"66666.6MB"</span></span><br><span class="line">            <span class="attr">android:title</span>=<span class="string">"清除缓存"</span>&gt;</span><span class="tag">&lt;/<span class="name">Preference</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Preference</span></span><br><span class="line">            <span class="attr">android:key</span>=<span class="string">"network"</span></span><br><span class="line">            <span class="attr">android:title</span>=<span class="string">"网络设置"</span>&gt;</span><span class="tag">&lt;/<span class="name">Preference</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">PreferenceCategory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">PreferenceCategory</span> <span class="attr">android:title</span>=<span class="string">"开发者设置"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Preference</span></span><br><span class="line">            <span class="attr">android:key</span>=<span class="string">"usbDebug"</span></span><br><span class="line">            <span class="attr">android:title</span>=<span class="string">"打开USB调试"</span>&gt;</span><span class="tag">&lt;/<span class="name">Preference</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Preference</span></span><br><span class="line">            <span class="attr">android:key</span>=<span class="string">"usbDebug"</span></span><br><span class="line">            <span class="attr">android:title</span>=<span class="string">"相机设置"</span>&gt;</span><span class="tag">&lt;/<span class="name">Preference</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">SwitchPreference</span></span><br><span class="line">            <span class="attr">android:key</span>=<span class="string">"usbDebug"</span></span><br><span class="line">            <span class="attr">android:title</span>=<span class="string">"禁止输出log"</span>&gt;</span><span class="tag">&lt;/<span class="name">SwitchPreference</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">PreferenceCategory</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">PreferenceScreen</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SettingFragment</span> <span class="keyword">extends</span> <span class="title">PreferenceFragment</span> <span class="keyword">implements</span> <span class="title">Initial</span>, <span class="title">Preference</span>.<span class="title">OnPreferenceClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Preference clearCache;</span><br><span class="line">    Preference network;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SettingFragment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Required empty public constructor</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        addPreferencesFromResource(R.xml.preference);</span><br><span class="line">        clearCache = findPreference(<span class="string">"clearCache"</span>);</span><br><span class="line">        clearCache.setOnPreferenceClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPreferenceClick</span><span class="params">(Preference preference)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (preference.equals(clearCache)) &#123;</span><br><span class="line">            clearCache.setSummary(<span class="string">"0MB"</span>);</span><br><span class="line">            Functions.toast(<span class="string">"清理缓存成功"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="示例-使用Preference-Headers-进阶"><a href="#示例-使用Preference-Headers-进阶" class="headerlink" title="示例 - 使用Preference Headers(进阶)"></a>示例 - 使用Preference Headers(进阶)</h3><blockquote>
<p>使用步骤<br>1.创建一个Fragment，继承PreferenceFragment。在其xml里编写二级页面的Preference。<br>2.创建一个SettingActivity继承PreferenceActivity。<br>3.在xml布局里使用preference-headers标签。使用android:fragment绑定上述Fragment。设置相关的title即可。<br>4.在SettingActivity中重写onBuildHeaders方法,调用loadHeadersFromResource方法加载布局即可。</p>
<p>Activity代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PreferenceActivity代码如下</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PreSettingActivity</span> <span class="keyword">extends</span> <span class="title">PreferenceActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBuildHeaders</span><span class="params">(List&lt;Header&gt; target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onBuildHeaders(target);</span><br><span class="line">        loadHeadersFromResource(R.xml.preference_headers, target);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isValidFragment</span><span class="params">(String fragmentName)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//解决在4.4崩溃报错的问题</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>R.xml.preference_headers</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">preference-headers</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span></span><br><span class="line">    <span class="attr">android:fragment</span>=<span class="string">"io.tanjundang.study.test.preference.UsuallyFragment"</span></span><br><span class="line">    <span class="attr">android:title</span>=<span class="string">"常用设置"</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">preference-headers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>UsuallyFragment代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UsuallyFragment</span> <span class="keyword">extends</span> <span class="title">PreferenceFragment</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        addPreferencesFromResource(R.xml.fragment_usually);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">PreferenceScreen</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Preference</span></span><br><span class="line">        <span class="attr">android:key</span>=<span class="string">"clearCache"</span></span><br><span class="line">        <span class="attr">android:summary</span>=<span class="string">"66666.6MB"</span></span><br><span class="line">        <span class="attr">android:title</span>=<span class="string">"清除缓存"</span>&gt;</span><span class="tag">&lt;/<span class="name">Preference</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Preference</span></span><br><span class="line">        <span class="attr">android:key</span>=<span class="string">"network"</span></span><br><span class="line">        <span class="attr">android:title</span>=<span class="string">"网络设置"</span>&gt;</span><span class="tag">&lt;/<span class="name">Preference</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">PreferenceScreen</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="http://imglf1.nosdn.127.net/img/ZFRpZXBrMUVQR0M3UUVidGw5dnl1SVhvNXA2MkJVVzNZVnBJSG9FVjlQaW95ZDlnK1dIREZnPT0.gif" alt=""></p>
<h3 id="使用时遇到的问题"><a href="#使用时遇到的问题" class="headerlink" title="使用时遇到的问题"></a>使用时遇到的问题</h3><blockquote>
<p>1.继承PreferenceActivity默认是没有ActoinBar的。需要利用AppCompatDelegate获取AppCompatActivity特性。<br>2.如何添加ActionBar？重写onpostCrete方法<br>3.由于版本安全问题，需要重写isValidFragment方法并返回true，否则报错。<br>Caused by: java.lang.RuntimeException: Subclasses of PreferenceActivity must override isValidFragment(String) to verify that the Fragment class is valid!<br>4.在二层页面Fragment修改ActionBar的标题。</p>
</blockquote>
<h4 id="PreferenceActivity添加Actionbar"><a href="#PreferenceActivity添加Actionbar" class="headerlink" title="PreferenceActivity添加Actionbar"></a>PreferenceActivity添加Actionbar</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PreSettingActivity</span> <span class="keyword">extends</span> <span class="title">PreferenceActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    AppCompatDelegate mDelegate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        getDelegate().installViewFactory();</span><br><span class="line">        getDelegate().onCreate(savedInstanceState);</span><br><span class="line">        getSupportActionBar().setDisplayHomeAsUpEnabled(<span class="keyword">true</span>);</span><br><span class="line">        getSupportActionBar().setDefaultDisplayHomeAsUpEnabled(<span class="keyword">true</span>);</span><br><span class="line">        getSupportActionBar().setTitle(<span class="string">"设置"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onPostCreate(savedInstanceState);</span><br><span class="line">        getDelegate().onPostCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActionBar <span class="title">getSupportActionBar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getDelegate().getSupportActionBar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBuildHeaders</span><span class="params">(List&lt;Header&gt; target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onBuildHeaders(target);</span><br><span class="line">        loadHeadersFromResource(R.xml.preference_headers, target);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function">AppCompatDelegate <span class="title">getDelegate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mDelegate == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mDelegate = AppCompatDelegate.create(<span class="keyword">this</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mDelegate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isValidFragment</span><span class="params">(String fragmentName)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//解决在4.4崩溃报错的问题</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (item.getItemId() == android.R.id.home) &#123;</span><br><span class="line">            finish();  <span class="comment">//监听返回键</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="在二层页面修改ActionBar标题"><a href="#在二层页面修改ActionBar标题" class="headerlink" title="在二层页面修改ActionBar标题"></a>在二层页面修改ActionBar标题</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UsuallyFragment</span> <span class="keyword">extends</span> <span class="title">PreferenceFragment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    PreSettingActivity mActivity;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint</span>(<span class="string">"NewApi"</span>)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        addPreferencesFromResource(R.xml.fragment_usually);</span><br><span class="line">        mActivity = (PreSettingActivity) getActivity();</span><br><span class="line">        mActivity.getSupportActionBar().setTitle(<span class="string">"常用设置"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt; 这里发现在PreferenceFragment的子类并不执行onAttatch方法，并未找到原因。</span><br></pre></td></tr></table></figure>
<p><a href="https://developer.android.com/guide/topics/ui/settings.html#BackCompatHeaders" target="_blank" rel="external">Android官方文档</a></p>


            <!-- Tags -->
            


<div class="tags">
    <a href="/tags/Preference的使用/">Preference的使用</a>
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>
</section><!-- end main -->

<!-- After footer scripts -->

<!-- jQuery -->
<script src="/js/jquery.js"></script>

<!-- Custom Code -->
<script src="/js/main.js"></script>

<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>