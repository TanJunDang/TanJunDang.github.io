<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Build a better app.">
    

    <!--Author-->
    
        <meta name="author" content="TanJunDang">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="RxJava、RxAndroid的理解"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="TanJunDang"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="undefined"/>
    

    <!-- Title -->
    
    <title>RxJava、RxAndroid的理解 - TanJunDang</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!--Favicon-->
    

</head>

<body>

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">TanJunDang</a>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives">Archives</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
            
                <li><a href="https://www.facebook.com/" class="fb" target="_blank" data-title="Facebook"></a></li>
            
            
                <li><a href="https://www.behance.net/" class="behance" target="_blank" data-title="Behance"></a></li>
            
            
                <li><a href="https://plus.google.com/+Pixelhint/posts" class="google" target="_blank" data-title="Google+"></a></li>
            
            
                <li><a href="https://dribbble.com/pixelhint" class="dribble" target="_blank" data-title="Dribble"></a></li>
            
            
            
            
        </ul><!-- end social -->

        <div class="rights">
            <p>Copyright © 2014 magnetic.</p>
            <p>Template by <a href="http://pixelhint.com/magnetic-free-html5-responsive-photography-website-template/">Pixelhint.com</a></p>
            <p>Hexo Theme by <a href="http://www.codeblocq.com/">Jonathan K.</a></p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('http://placehold.it/1300x500');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a href="/2016/07/05/Share/" class="previous" data-title="常用开发工具、框架、网站"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a href="/2016/05/31/Project-CacheModel/" class="next" data-title="Android框架设计-APP缓存..."></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">RxJava、RxAndroid的理解</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h1 id="RxJava是什么"><a href="#RxJava是什么" class="headerlink" title="RxJava是什么"></a>RxJava是什么</h1><blockquote>
<p>理解<br>1.可以理解为RxJava是一个异步操作的库。<br>2.RxJava使代码简洁、逻辑清晰。<br>3.用于处理观察者模式(事件总线)的需求。<br>4.可以取出集合元素逐个处理。</p>
</blockquote>
<a id="more"></a>
<h2 id="适用场合"><a href="#适用场合" class="headerlink" title="适用场合"></a>适用场合</h2><blockquote>
<p>事件A（观察者）对事件B（被观察者）的某种变化高度敏感，需要在B变化的一瞬间做出反应。（高敏感度监听）</p>
</blockquote>
<h2 id="常见术语"><a href="#常见术语" class="headerlink" title="常见术语"></a>常见术语</h2><p>Observable：发射源，被观察者。</p>
<p>Observer：接收源，观察者模式中的“观察者”，可接收Observable、Subject发射的数据；</p>
<p>Subscriber：接收源，观察者模式中的订阅者，那它跟Observer有什么区别呢？Subscriber实现了Observer接口，比Observer多了一个最重要的方法unsubscribe( )，用来取消订阅，当你不再想接收数据了，可以调用unsubscribe( )方法停止接收，Observer 在 subscribe() 过程中,最终也会被转换成 Subscriber 对象，一般情况下，建议使用Subscriber作为接收源；</p>
<p>Subscription ：Observable调用subscribe( )方法返回的对象，同样有unsubscribe( )方法，可以用来取消订阅事件；</p>
<p>Action0：RxJava中的一个接口，它只有一个无参call（）方法，且无返回值，同样还有Action1，Action2…Action9等，Action1封装了含有 1 个参的call（）方法，即call（T t），Action2封装了含有 2 个参数的call方法，即call（T1 t1，T2 t2），以此类推；</p>
<p>Func0：与Action0非常相似，也有call（）方法，但是它是有返回值的，同样也有Func0、Func1…Func9;</p>
<h1 id="RxJava"><a href="#RxJava" class="headerlink" title="RxJava"></a>RxJava</h1><h2 id="基础使用方法"><a href="#基础使用方法" class="headerlink" title="基础使用方法"></a>基础使用方法</h2><blockquote>
<p>发布者Observerable、订阅者Subscriber、订阅方法subscribe()<br>发布者调用create方法创建对象，订阅者创建对象通过onNext方法接收消息，发布者通过订阅方法绑定订阅者(即发布消息给订阅者)。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发布者,发布相关消息</span></span><br><span class="line">observable = Observable.create(<span class="keyword">new</span> Observable.OnSubscribe&lt;TestEvent&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> TestEvent&gt; sub)</span> </span>&#123;</span><br><span class="line">        TestEvent testEvent = <span class="keyword">new</span> TestEvent();</span><br><span class="line">        testEvent.setMsg(<span class="string">"do something"</span>);</span><br><span class="line">        sub.onNext(testEvent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//订阅者，获取发布者的消息。</span></span><br><span class="line">subscriber = <span class="keyword">new</span> Subscriber&lt;TestEvent&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(TestEvent event)</span> </span>&#123;</span><br><span class="line">        Functions.toast(TestActivity.<span class="keyword">this</span>, event.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//发布者发布消息</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RxAndroid</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    observable.subscribe(subscriber);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Just处理集合和对象"><a href="#Just处理集合和对象" class="headerlink" title="Just处理集合和对象"></a>Just处理集合和对象</h2><blockquote>
<p>Just方法,直接传入相关的事件即可(默认会创建对象、调用onNext等方法)。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//跟上述代码一样</span></span><br><span class="line"></span><br><span class="line">TestEvent testEvent = <span class="keyword">new</span> TestEvent();</span><br><span class="line">testEvent.setMsg(<span class="string">"read the fucking code"</span>);</span><br><span class="line">observable = Observable.just(testEvent);</span><br><span class="line"><span class="comment">//just可传入多个事件，依次调用onNext(testEvent)，onNext(finishEvent);；</span></span><br><span class="line"><span class="comment">//observable = Observable.just(testEvent，finishEvent);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建Action1对象，处理接收到的信息。</span></span><br><span class="line">onNextAction = <span class="keyword">new</span> Action1&lt;TestEvent&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(TestEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//发布者发布消息</span></span><br><span class="line"><span class="comment">//@onNextAction 主要处理事件</span></span><br><span class="line"><span class="comment">//onErrorAction、onCompleteAction可以没有</span></span><br><span class="line"></span><br><span class="line">observable.subscribe(onNextAction);</span><br><span class="line"><span class="comment">//myObservable.subscribe(onNextAction, onErrorAction, onCompleteAction);</span></span><br></pre></td></tr></table></figure>
<h3 id="最后缩减代码优化"><a href="#最后缩减代码优化" class="headerlink" title="最后缩减代码优化"></a>最后缩减代码优化</h3><blockquote>
<p>不需要创建Observable引用,直接使用just操作符以及subscribe方法即可。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接传入事件,并且创建Action1对象即可。</span></span><br><span class="line"></span><br><span class="line">TestEvent testEvent = <span class="keyword">new</span> TestEvent();</span><br><span class="line">testEvent.setMsg(<span class="string">"read the fucking code"</span>);</span><br><span class="line">Observable.just(testEvent)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Action1&lt;TestEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(TestEvent event)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//对接收到的event进行处理</span></span><br><span class="line">				Functions.toast(TestActivity.<span class="keyword">this</span>, event.getMsg());</span><br><span class="line">            &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="from处理集合元素"><a href="#from处理集合元素" class="headerlink" title="from处理集合元素"></a>from处理集合元素</h2><blockquote>
<p>from操作符作用相当于对集合的每个元素进行处理,即跟循环获取元素的功能。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//普通类型Object、List、Set</span></span><br><span class="line">String[] strs = <span class="keyword">new</span> String[]&#123;<span class="string">"TAN"</span>, <span class="string">"JUN"</span>, <span class="string">"DANG"</span>&#125;;</span><br><span class="line">Observable</span><br><span class="line">.from(strs)</span><br><span class="line">.subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//依次输出TAN,JUN,DANG</span></span><br><span class="line">        LogUtil.v(TAG, event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//集合类型HashMap</span></span><br><span class="line">HashMap&lt;Integer, String&gt; map = <span class="keyword">new</span> HashMap();</span><br><span class="line">map.put(<span class="number">1</span>, <span class="string">"TAN"</span>);</span><br><span class="line">map.put(<span class="number">2</span>, <span class="string">"JUN"</span>);</span><br><span class="line">map.put(<span class="number">3</span>, <span class="string">"DANG"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//对HashMap的特殊处理,需要用到map的entrySet方法</span></span><br><span class="line"></span><br><span class="line">Observable</span><br><span class="line">.from(map.entrySet())</span><br><span class="line">.subscribe(<span class="keyword">new</span> Action1&lt;Map.Entry&lt;Integer, String&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Map.Entry&lt;Integer, String&gt; entry)</span> </span>&#123;</span><br><span class="line">        LogUtil.v(TAG, <span class="string">"key:"</span> + entry.getKey() + <span class="string">"\nvalue:"</span> + entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>总结：使用from操作符后不能再返回对象，否则会报转型错。</p>
</blockquote>
<h2 id="Map改变原返回对象类型"><a href="#Map改变原返回对象类型" class="headerlink" title="Map改变原返回对象类型"></a>Map改变原返回对象类型</h2><blockquote>
<p>理解<br>map操作符的作用是改变call方法的返回类型(一对一转换)，map(待转类型,目标类型)。<br>传入某个值，进行一系列的操作后，输出另一个值。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TestEvent testEvent = <span class="keyword">new</span> TestEvent();</span><br><span class="line">testEvent.setMsg(<span class="string">"read the fucking code"</span>);</span><br><span class="line">Observable.just(testEvent)</span><br><span class="line"><span class="comment">//通过map方法，将TestEvent对象转换成String对象</span></span><br><span class="line">        .map(<span class="keyword">new</span> Func1&lt;TestEvent, String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">(TestEvent event)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//这里直接返回TestEvent的getMsg()信息</span></span><br><span class="line">                <span class="keyword">return</span> event.getMsg();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="comment">//此处Action要跟map返回的类型一致。</span></span><br><span class="line">        .subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String event)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//对接收到的event进行处理</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="flatMap改变原返回对象类型"><a href="#flatMap改变原返回对象类型" class="headerlink" title="flatMap改变原返回对象类型"></a>flatMap改变原返回对象类型</h2><blockquote>
<p>flatMap操作符的作用是改变call方法的返回对象Obserable的类型(一对多转换)，flatMap(待转类型,目标类型)。</p>
</blockquote>
<h2 id="interval间隔发射序列"><a href="#interval间隔发射序列" class="headerlink" title="interval间隔发射序列"></a>interval间隔发射序列</h2><blockquote>
<p>interval指间隔发射序列。常跟take连用。<br>take指取序列中的第几个。</p>
</blockquote>
<h2 id="Scheduler切换线程"><a href="#Scheduler切换线程" class="headerlink" title="Scheduler切换线程"></a>Scheduler切换线程</h2><blockquote>
<p>引入背景<br>RxJava默认的操作时在主线程执行的，若在执行代码时中有耗时操作，则会导致线程阻塞。所以应该切换线程进行处理。<br>操作符<br>切换线程有两个操作符，subscribeOn、observeOn。</p>
</blockquote>
<h3 id="操作符类型"><a href="#操作符类型" class="headerlink" title="操作符类型"></a>操作符类型</h3><table>
<thead>
<tr>
<th>操作符类型</th>
<th>操作符</th>
</tr>
</thead>
<tbody>
<tr>
<td>产生操作符</td>
<td>create()、just()、from()、repeat()、interval()、range()、timer()、empty()、等</td>
</tr>
<tr>
<td>加工操作符</td>
<td>map()、flapMap()、scan()、filter()等</td>
</tr>
<tr>
<td>消费操作符</td>
<td>subscribe()</td>
</tr>
</tbody>
</table>
<blockquote>
<p>更多的操作符类型看文章结尾。</p>
</blockquote>
<h3 id="Scheduler分类"><a href="#Scheduler分类" class="headerlink" title="Scheduler分类"></a>Scheduler分类</h3><p>Schedulers.immediate()：直接在当前线程运行，相当于不指定线程。这是默认的 Scheduler。<br>Schedulers.newThread()：总是启用新线程，并在新线程执行操作。<br>Schedulers.io()： I/O 操作（读写文件、读写数据库、网络信息交互等）所使用的 Scheduler。行为模式和 newThread() 差不多，区别在于 io() 的内部实现是是用一个无数量上限的线程池，可以重用空闲的线程，因此多数情况下 io() 比 newThread() 更有效率。不要把计算工作放在 io() 中，可以避免创建不必要的线程。<br>Schedulers.computation()：计算所使用的 Scheduler。这个计算指的是 CPU 密集型计算，即不会被 I/O 等操作限制性能的操作，例如图形的计算。这个 Scheduler 使用的固定的线程池，大小为 CPU 核数。不要把 I/O 操作放在 computation() 中，否则 I/O 操作的等待时间会浪费 CPU。<br>AndroidSchedulers.mainThread()：它指定的操作将在 Android 主线程运行。</p>
<h3 id="subscribeOn、observeOn两者的区别"><a href="#subscribeOn、observeOn两者的区别" class="headerlink" title="subscribeOn、observeOn两者的区别"></a>subscribeOn、observeOn两者的区别</h3><blockquote>
<p>切换线程操作符受操作符类型影响</p>
</blockquote>
<h3 id="subscribeOn操作符"><a href="#subscribeOn操作符" class="headerlink" title="subscribeOn操作符"></a>subscribeOn操作符</h3><blockquote>
<p>作用域<br>1.作用开始于产生操作符.(见上表)。<br>2.若subscribeOn之前有observeOn操作符，则前面的加工操作符无效。<br>3.作用于之后的操作符。直到下一个observeOn操作符出现。</p>
</blockquote>
<h3 id="observeOn操作符"><a href="#observeOn操作符" class="headerlink" title="observeOn操作符"></a>observeOn操作符</h3><blockquote>
<p>作用域<br>作用于observeOn之后的操作符，直到下一个observeOn出现。</p>
</blockquote>
<h1 id="用RxJava封装成RxBus"><a href="#用RxJava封装成RxBus" class="headerlink" title="用RxJava封装成RxBus"></a>用RxJava封装成RxBus</h1><h2 id="RXJAVA1-0"><a href="#RXJAVA1-0" class="headerlink" title="RXJAVA1.0"></a>RXJAVA1.0</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxBus</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> RxBus defaultInstance;</span><br><span class="line">    <span class="comment">// 主题</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Subject bus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PublishSubject只会把在订阅发生的时间点之后来自原始Observable的数据发射给观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RxBus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        bus = <span class="keyword">new</span> SerializedSubject&lt;&gt;(PublishSubject.create());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单例RxBus</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RxBus <span class="title">getDefault</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RxBus rxBus = defaultInstance;</span><br><span class="line">        <span class="keyword">if</span> (defaultInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (RxBus.class) &#123;</span><br><span class="line">                rxBus = defaultInstance;</span><br><span class="line">                <span class="keyword">if</span> (defaultInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    rxBus = <span class="keyword">new</span> RxBus();</span><br><span class="line">                    defaultInstance = rxBus;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rxBus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提供了一个新的事件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        bus.onNext(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">   <span class="comment">// 根据传递的 eventType 类型返回特定类型(eventType)的 被观察者,在处理的时候的线程是主线程</span></span><br><span class="line">   <span class="comment">//  @param eventType</span></span><br><span class="line">   <span class="comment">// @param &lt;T&gt;</span></span><br><span class="line">   <span class="comment">// @return</span></span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">toObservable</span><span class="params">(Class&lt;T&gt; eventType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bus.observeOn(AndroidSchedulers.mainThread()).ofType(eventType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="示例-RxBUS的使用"><a href="#示例-RxBUS的使用" class="headerlink" title="示例 - RxBUS的使用"></a>示例 - RxBUS的使用</h2><blockquote>
<p>接收页面需要定义全局变量Subscription testScption,并且反注册.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发送消息</span></span><br><span class="line">RxBus.getDefault().post(<span class="keyword">new</span> TestEvent());</span><br><span class="line"><span class="comment">//接收处理</span></span><br><span class="line">testScption = RxBus.getDefault().toObservable(TestEvent.class).subscribe(<span class="keyword">new</span> Action1&lt;TestEvent&gt;() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(TestEvent testEvent)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//收到消息后做相应的处理</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//反注册</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    <span class="keyword">if</span> (testScption != <span class="keyword">null</span> &amp;&amp; !testScption.isUnsubscribed()) &#123;</span><br><span class="line">        testScption.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="RXJAVA2-0"><a href="#RXJAVA2-0" class="headerlink" title="RXJAVA2.0"></a>RXJAVA2.0</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxBus</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> RxBus defaultInstance;</span><br><span class="line">    <span class="comment">// 主题</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Subject bus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PublishSubject只会把在订阅发生的时间点之后来自原始Observable的数据发射给观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RxBus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        bus = PublishSubject.create().toSerialized();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单例RxBus</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RxBus <span class="title">getDefault</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RxBus rxBus = defaultInstance;</span><br><span class="line">        <span class="keyword">if</span> (defaultInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (RxBus.class) &#123;</span><br><span class="line">                rxBus = defaultInstance;</span><br><span class="line">                <span class="keyword">if</span> (defaultInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    rxBus = <span class="keyword">new</span> RxBus();</span><br><span class="line">                    defaultInstance = rxBus;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rxBus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一定要post一个对象而不是Event.class</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        bus.onNext(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 根据传递的 eventType 类型返回特定类型(eventType)的 被观察者,在处理的时候的线程是主线程</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> eventType</span><br><span class="line">     * <span class="doctag">@param</span> &lt;T&gt;</span><br><span class="line">     * <span class="doctag">@return</span></span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">toObservable</span><span class="params">(Class&lt;T&gt; eventType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bus.observeOn(AndroidSchedulers.mainThread()).ofType(eventType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Rxjava2-0"><a href="#Rxjava2-0" class="headerlink" title="Rxjava2.0"></a>Rxjava2.0</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rxjava2.0 常用流程</span></span><br><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">              <span class="meta">@Override</span></span><br><span class="line">              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                  e.onNext(<span class="number">1</span>);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;).subscribeOn(Schedulers.io()).doOnNext(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">              <span class="meta">@Override</span></span><br><span class="line">              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                  LogTool.v(<span class="string">"TAG"</span>, <span class="string">"过程1："</span> + integer);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;).observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                  .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">                      <span class="meta">@Override</span></span><br><span class="line">                      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                          LogTool.v(<span class="string">"TAG"</span>, <span class="string">"过程2："</span> + integer);</span><br><span class="line">                          Functions.toast(<span class="string">"6666666"</span>);</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;);</span><br></pre></td></tr></table></figure>
<p><a href="http://www.jianshu.com/p/d149043d103a" target="_blank" rel="external">RXJAVA2.0一些操作符的使用</a></p>
<h1 id="操作符大全"><a href="#操作符大全" class="headerlink" title="操作符大全"></a>操作符大全</h1><h2 id="创建操作符：负责创建Observable对象"><a href="#创建操作符：负责创建Observable对象" class="headerlink" title="创建操作符：负责创建Observable对象"></a>创建操作符：负责创建Observable对象</h2><p>just( ) — 将一个或多个对象转换成发射这个或这些对象的一个Observable<br>from( ) — 将一个Iterable, 一个Future, 或者一个数组转换成一个Observable<br>repeat( ) — 创建一个重复发射指定数据或数据序列的Observable<br>repeatWhen( ) — 创建一个重复发射指定数据或数据序列的Observable，它依赖于另一个Observable发射的数据<br>create( ) — 使用一个函数从头创建一个Observable<br>defer( ) — 只有当订阅者订阅才创建Observable；为每个订阅创建一个新的Observable<br>range( ) — 创建一个发射指定范围的整数序列的Observable<br>interval( ) — 创建一个按照给定的时间间隔发射整数序列的Observable<br>timer( ) — 创建一个在给定的延时之后发射单个数据的Observable<br>empty( ) — 创建一个什么都不做直接通知完成的Observable<br>error( ) — 创建一个什么都不做直接通知错误的Observable<br>never( ) — 创建一个不发射任何数据的Observable</p>
<h2 id="变换操作符：对Observable发射的数据执行变换操作的各种操作符"><a href="#变换操作符：对Observable发射的数据执行变换操作的各种操作符" class="headerlink" title="变换操作符：对Observable发射的数据执行变换操作的各种操作符"></a>变换操作符：对Observable发射的数据执行变换操作的各种操作符</h2><p>map( ) — 对序列的每一项都应用一个函数来变换Observable发射的数据序列<br>flatMap( ), concatMap( ), and flatMapIterable( ) — 将Observable发射的数据集合变换为Observables集合，然后将这些Observable发射的数据平坦化的放进一个单独的Observable<br>switchMap( ) — 将Observable发射的数据集合变换为Observables集合，然后只发射这些Observables最近发射的数据<br>scan( ) — 对Observable发射的每一项数据应用一个函数，然后按顺序依次发射每一个值<br>groupBy( ) — 将Observable分拆为Observable集合，将原始Observable发射的数据按Key分组，每一个Observable发射一组不同的数据<br>buffer( ) — 它定期从Observable收集数据到一个集合，然后把这些数据集合打包发射，而不是一次发射一个<br>window( ) — 定期将来自Observable的数据分拆成一些Observable窗口，然后发射这些窗口，而不是每次发射一项<br>cast( ) — 在发射之前强制将Observable发射的所有数据转换为指定类型</p>
<h2 id="过滤操作符：用于过滤和选择Observable发射的数据序列"><a href="#过滤操作符：用于过滤和选择Observable发射的数据序列" class="headerlink" title="过滤操作符：用于过滤和选择Observable发射的数据序列"></a>过滤操作符：用于过滤和选择Observable发射的数据序列</h2><p>filter( ) — 过滤数据<br>takeLast( ) — 只发射最后的N项数据<br>last( ) — 只发射最后的一项数据<br>lastOrDefault( ) — 只发射最后的一项数据，如果Observable为空就发射默认值<br>takeLastBuffer( ) — 将最后的N项数据当做单个数据发射<br>skip( ) — 跳过开始的N项数据<br>skipLast( ) — 跳过最后的N项数据<br>take( ) — 只发射开始的N项数据<br>first( ) and takeFirst( ) — 只发射第一项数据，或者满足某种条件的第一项数据<br>firstOrDefault( ) — 只发射第一项数据，如果Observable为空就发射默认值<br>elementAt( ) — 发射第N项数据<br>elementAtOrDefault( ) — 发射第N项数据，如果Observable数据少于N项就发射默认值<br>sample( ) or throttleLast( ) — 定期发射Observable最近的数据<br>throttleFirst( ) — 定期发射Observable发射的第一项数据<br>throttleWithTimeout( ) or debounce( ) — 只有当Observable在指定的时间后还没有发射数据时，才发射一个数据<br>timeout( ) — 如果在一个指定的时间段后还没发射数据，就发射一个异常<br>distinct( ) — 过滤掉重复数据<br>distinctUntilChanged( ) — 过滤掉连续重复的数据<br>ofType( ) — 只发射指定类型的数据<br>ignoreElements( ) — 丢弃所有的正常数据，只发射错误或完成通知</p>
<h2 id="结合操作符：用于组合多个Observables的组合使用"><a href="#结合操作符：用于组合多个Observables的组合使用" class="headerlink" title="结合操作符：用于组合多个Observables的组合使用"></a>结合操作符：用于组合多个Observables的组合使用</h2><p>startWith( ) — 在数据序列的开头增加一项数据<br>merge( ) — 将多个Observable合并为一个<br>mergeDelayError( ) — 合并多个Observables，让没有错误的Observable都完成后再发射错误通知<br>zip( ) — 使用一个函数组合多个Observable发射的数据集合，然后再发射这个结果<br>and( ), then( ), and when( ) — (rxjava-joins) 通过模式和计划组合多个Observables发射的数据集合<br>combineLatest( ) — 当两个Observables中的任何一个发射了一个数据时，通过一个指定的函数组合每个Observable发射的最新数据（一共两个数据），然后发射这个函数的结果<br>join( ) and groupJoin( ) — 无论何时，如果一个Observable发射了一个数据项，只要在另一个Observable发射的数据项定义的时间窗口内，就将两个Observable发射的数据合并发射<br>switchOnNext( ) — 将一个发射Observables的Observable转换成另一个Observable，后者发射这些Observables最近发射的数据</p>
<h2 id="辅助操作符：用于Observable的辅助操作符"><a href="#辅助操作符：用于Observable的辅助操作符" class="headerlink" title="辅助操作符：用于Observable的辅助操作符"></a>辅助操作符：用于Observable的辅助操作符</h2><p>materialize( ) — 将Observable转换成一个通知列表convert an Observable into a list of Notifications<br>dematerialize( ) — 将上面的结果逆转回一个Observable<br>timestamp( ) — 给Observable发射的每个数据项添加一个时间戳<br>serialize( ) — 强制Observable按次序发射数据并且要求功能是完好的<br>cache( ) — 记住Observable发射的数据序列并发射相同的数据序列给后续的订阅者<br>observeOn( ) — 指定观察者观察Observable的调度器<br>subscribeOn( ) — 指定Observable执行任务的调度器<br>doOnEach( ) — 注册一个动作，对Observable发射的每个数据项使用<br>doOnCompleted( ) — 注册一个动作，对正常完成的Observable使用<br>doOnError( ) — 注册一个动作，对发生错误的Observable使用<br>doOnTerminate( ) — 注册一个动作，对完成的Observable使用，无论是否发生错误<br>doOnSubscribe( ) — 注册一个动作，在观察者订阅时使用<br>doOnUnsubscribe( ) — 注册一个动作，在观察者取消订阅时使用<br>finallyDo( ) — 注册一个动作，在Observable完成时使用<br>delay( ) — 延时发射Observable的结果<br>delaySubscription( ) — 延时处理订阅请求<br>timeInterval( ) — 定期发射数据<br>using( ) — 创建一个只在Observable生命周期存在的资源<br>single( ) — 强制返回单个数据，否则抛出异常<br>singleOrDefault( ) — 如果Observable完成时返回了单个数据，就返回它，否则返回默认数据<br>toFuture( ), toIterable( ), toList( ) — 将Observable转换为其它对象或数据结构</p>
<h1 id="RXJAVA1-0-线程切换示例"><a href="#RXJAVA1-0-线程切换示例" class="headerlink" title="RXJAVA1.0 - 线程切换示例"></a>RXJAVA1.0 - 线程切换示例</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Observable</span><br><span class="line">            .create(<span class="keyword">new</span> Observable.OnSubscribe&lt;String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> String&gt; subscriber)</span> </span>&#123;</span><br><span class="line">                    Logger.v(<span class="string">"rx_call"</span>, Thread.currentThread().getName());</span><br><span class="line"></span><br><span class="line">                    subscriber.onNext(<span class="string">"dd"</span>);</span><br><span class="line">                    subscriber.onCompleted();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">            .observeOn(Schedulers.newThread())    <span class="comment">//新线程</span></span><br><span class="line">            .map(<span class="keyword">new</span> Func1&lt;String, String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                    Logger.v(<span class="string">"rx_map"</span>, Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">return</span> s + <span class="string">"88"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .observeOn(Schedulers.io())      <span class="comment">//io线程</span></span><br><span class="line">            .filter(<span class="keyword">new</span> Func1&lt;String, Boolean&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Boolean <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                    Logger.v(<span class="string">"rx_filter"</span>, Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">return</span> s != <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .subscribeOn(Schedulers.io())     <span class="comment">//定义事件产生线程：io线程</span></span><br><span class="line">            .map(<span class="keyword">new</span> Func1&lt;String, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                    Logger.v(<span class="string">"rx_map2"</span>, Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">return</span> s + <span class="string">"rx_map2"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .observeOn(AndroidSchedulers.mainThread())     <span class="comment">//事件消费线程：主线程</span></span><br><span class="line">            .subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                    Logger.v(<span class="string">"rx_subscribe"</span>, Thread.currentThread().getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure>
<h1 id="RXJAVA2-0-线程切换示例"><a href="#RXJAVA2-0-线程切换示例" class="headerlink" title="RXJAVA2.0 - 线程切换示例"></a>RXJAVA2.0 - 线程切换示例</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;ArrayList&lt;ImageInfo&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(@NonNull ObservableEmitter&lt;ArrayList&lt;ImageInfo&gt;&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!e.isDisposed()) &#123;</span><br><span class="line">              <span class="comment">// 发射数据</span></span><br><span class="line">                e.onNext(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).</span><br><span class="line">            map(<span class="keyword">new</span> Function&lt;ArrayList&lt;ImageInfo&gt;, ArrayList&lt;ImageInfo&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> ArrayList&lt;ImageInfo&gt; <span class="title">apply</span><span class="params">(@NonNull ArrayList&lt;ImageInfo&gt; imageInfos)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                  <span class="comment">// 在io线程执行一串耗时操作</span></span><br><span class="line">                    <span class="keyword">int</span> cacheGroup = -<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">int</span> cacheSmallGroup = -<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; imageInfos.size(); i++) &#123;</span><br><span class="line">                        ImageInfo info = ImageQueryTool.getInstance().getImageData().get(i);</span><br><span class="line">                        File file = <span class="keyword">new</span> File(info.getPath());</span><br><span class="line">                        File smallFile = Compressor.getDefault(MainActivity.<span class="keyword">this</span>).compressToFile(file);</span><br><span class="line">                        info.setPath(smallFile.getPath());</span><br><span class="line">                        list.add(info);</span><br><span class="line"><span class="comment">//                    控制是否显示大组View</span></span><br><span class="line">                        <span class="keyword">if</span> (cacheSmallGroup != info.getGroup()) &#123;</span><br><span class="line">                            smallGroupPos.add(i);</span><br><span class="line">                            cacheSmallGroup = info.getGroup();</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (info.getBigGroup() != cacheGroup) &#123;</span><br><span class="line">                                smallGroupPos.add(i);</span><br><span class="line">                                cacheSmallGroup = info.getGroup();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (info.getBigGroup() != cacheGroup) &#123;</span><br><span class="line">                            bigGroupPos.add(i);</span><br><span class="line">                            cacheGroup = info.getBigGroup();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> list;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).</span><br><span class="line">            subscribeOn(Schedulers.io()).</span><br><span class="line">            observeOn(AndroidSchedulers.mainThread()).</span><br><span class="line">            subscribe(<span class="keyword">new</span> Observer&lt;ArrayList&lt;ImageInfo&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(@NonNull Disposable d)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(@NonNull ArrayList&lt;ImageInfo&gt; imageInfos)</span> </span>&#123;</span><br><span class="line">                  <span class="comment">// 切换到UI线程更新UI</span></span><br><span class="line">                    myAdapter.notifyDataSetChanged();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(@NonNull Throwable e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure>
<p><a href="http://blog.danlew.net/2014/09/15/grokking-rxjava-part-1/" target="_blank" rel="external">RxJava英文参考</a><br><a href="http://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="external">给Android开发者的RxJava</a><br><a href="http://www.jianshu.com/p/ca090f6e2fe2" target="_blank" rel="external">RxBus参考</a><br><a href="https://github.com/lzyzsd/Awesome-RxJava" target="_blank" rel="external">Rx大全</a><br><a href="http://www.jianshu.com/p/5e93c9101dc5" target="_blank" rel="external">Rx基础</a><br><a href="http://www.jianshu.com/p/ecfb9d68d2a2" target="_blank" rel="external">RxJava切换线程</a><br><a href="http://www.cnblogs.com/zhaoyanjun/p/5624395.html" target="_blank" rel="external">线程切换例子</a></p>


            <!-- Tags -->
            


<div class="tags">
    <a href="/tags/RxJava、RxAndroid的理解/">RxJava、RxAndroid的理解</a>
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>
</section><!-- end main -->

<!-- After footer scripts -->

<!-- jQuery -->
<script src="/js/jquery.js"></script>

<!-- Custom Code -->
<script src="/js/main.js"></script>

<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>