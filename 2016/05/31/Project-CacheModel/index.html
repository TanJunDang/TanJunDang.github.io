<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Build a better app.">
    

    <!--Author-->
    
        <meta name="author" content="TanJunDang">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Android框架设计-APP缓存策略"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="TanJunDang"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="undefined"/>
    

    <!-- Title -->
    
    <title>Android框架设计-APP缓存策略 - TanJunDang</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!--Favicon-->
    

</head>

<body>

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">TanJunDang</a>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives">Archives</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
            
                <li><a href="https://www.facebook.com/" class="fb" target="_blank" data-title="Facebook"></a></li>
            
            
                <li><a href="https://www.behance.net/" class="behance" target="_blank" data-title="Behance"></a></li>
            
            
                <li><a href="https://plus.google.com/+Pixelhint/posts" class="google" target="_blank" data-title="Google+"></a></li>
            
            
                <li><a href="https://dribbble.com/pixelhint" class="dribble" target="_blank" data-title="Dribble"></a></li>
            
            
            
            
        </ul><!-- end social -->

        <div class="rights">
            <p>Copyright © 2014 magnetic.</p>
            <p>Template by <a href="http://pixelhint.com/magnetic-free-html5-responsive-photography-website-template/">Pixelhint.com</a></p>
            <p>Hexo Theme by <a href="http://www.codeblocq.com/">Jonathan K.</a></p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('http://placehold.it/1300x500');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a href="/2016/06/13/RxAndroid/" class="previous" data-title="RxJava、RxAndroid的理解"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a href="/2016/05/31/GsonTool/" class="next" data-title="工具类的编写 - Gson的封装"></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">Android框架设计-APP缓存策略</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h1 id="APP缓存策略"><a href="#APP缓存策略" class="headerlink" title="APP缓存策略"></a>APP缓存策略</h1><blockquote>
<p>理解<br>何时使用缓存？<br>无网络时、需要定时读取本地数据的时候。<br>缓存保存在哪？<br>缓存可以保存在内存、数据库、文件、SharePreference里。<br>什么数据适合缓存？<br>变化性较少的，即时性低的。例如广告图、用户名、个人信息等。<br>缓存什么时候清空？<br>用户卸载后清空。<br>注意这里的缓存跟里的缓存不一致.临时数据放在</p>
</blockquote>
<a id="more"></a>
<table>
<thead>
<tr>
<th>缓存方式</th>
<th>缓存位置</th>
<th>相关方法</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>内存</td>
<td>全局保存的变量类Global</td>
<td>全局使用的变量，例如发布类型</td>
</tr>
<tr>
<td>数据库</td>
<td>/data/data/XXXpackage/databases/</td>
</tr>
<tr>
<td>文件</td>
<td>/data/data/XXX/</td>
<td>getCacheDir()、getFilesDir()</td>
<td>模块共用的信息(实体类)，例如User</td>
</tr>
<tr>
<td>SharePreference</td>
<td>XML</td>
<td>getXX、PutXX</td>
<td>保存一些模块共用的字段</td>
<td>常用的某个普通类型，例如String、boolean</td>
</tr>
</tbody>
</table>
<blockquote>
<p>通常保存账户信息需要重新定义一个路径而不是用getCacheDir/getFileDir的路径。</p>
<p>涉及文件操作 <a href="/2016/05/05/Android-File/">File</a></p>
</blockquote>
<h1 id="实例-本地缓存"><a href="#实例-本地缓存" class="headerlink" title="实例 - 本地缓存"></a>实例 - 本地缓存</h1><h2 id="框架-将网络数据保存到本地-Model类的编写"><a href="#框架-将网络数据保存到本地-Model类的编写" class="headerlink" title="框架 - 将网络数据保存到本地(Model类的编写)"></a>框架 - 将网络数据保存到本地(Model类的编写)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//该类的主要作用是将网络数据保存到本地，方便不同的页面调用。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseModel</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FOLDER = <span class="string">"BUFFER"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存</span></span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DataCache</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line"><span class="comment">// 通用保存方法</span></span><br><span class="line">		<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(context,folder,filename,data)</span></span>&#123;&#125;</span><br><span class="line"><span class="comment">// 加载对象</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadObject</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"><span class="comment">// 加载list</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadList</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存对象</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveObject</span><span class="params">(Object obj)</span></span>&#123;&#125;</span><br><span class="line"><span class="comment">// 保存list</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveList</span><span class="params">(ArrayList&lt;T&gt; list)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="代码-写入方法的实现"><a href="#代码-写入方法的实现" class="headerlink" title="代码 - 写入方法的实现"></a>代码 - 写入方法的实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 写数据要提供文件的路径、文件名、数据</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@param</span> context  上下文 - 用于创建文件路径</span><br><span class="line"> * <span class="doctag">@param</span> folder   目录 需要判断是否为空</span><br><span class="line"> * <span class="doctag">@param</span> filename 文件名</span><br><span class="line"> * <span class="doctag">@param</span> data     数据</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Context context, String folder, String filename, Object data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (context == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (folder == <span class="keyword">null</span> || folder.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">        folder = FOLDER;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//确定文件路径</span></span><br><span class="line">    File filedir = <span class="keyword">new</span> File(context.getCacheDir().getPath(), folder);</span><br><span class="line">    <span class="keyword">if</span> (!filedir.exists() || !filedir.isDirectory()) &#123;</span><br><span class="line">        filedir.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//确定文件</span></span><br><span class="line">    File file = <span class="keyword">new</span> File(filedir, filename);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果文件存在,则删除原有文件(清空原有数据)</span></span><br><span class="line">    <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">        file.delete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果文件不存在,输出流会自动创建文件,所以不需要createNewFile</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//操作数据</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(file));</span><br><span class="line">        oos.writeObject(data);</span><br><span class="line">        oos.flush();</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="代码-读取方法的实现"><a href="#代码-读取方法的实现" class="headerlink" title="代码 - 读取方法的实现"></a>代码 - 读取方法的实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ArrayList&lt;T&gt; T <span class="title">loadList</span><span class="params">(Context context ,String filename)</span></span>&#123;</span><br><span class="line"><span class="comment">//public &lt;T&gt; T loadObject(Context context ,String filename)&#123;</span></span><br><span class="line"></span><br><span class="line">	ArrayList&lt;T&gt; data = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//	T data = null;</span></span><br><span class="line">	<span class="comment">/*</span><br><span class="line">	*确定文件夹的路径</span><br><span class="line">	*/</span></span><br><span class="line">	 File fileDir = <span class="keyword">new</span> File(context.getFilesDir(), FOLDER);</span><br><span class="line">     <span class="keyword">if</span> (!fileDir.exists() || !fileDir.isDirectory()) &#123;</span><br><span class="line">         fileDir.mkdirs();</span><br><span class="line">     &#125;</span><br><span class="line">	<span class="comment">/*</span><br><span class="line">	*确定文件是否存在</span><br><span class="line">	*/</span></span><br><span class="line">     File file = <span class="keyword">new</span> File(fileDir, filename);</span><br><span class="line">     <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">         file.delete();</span><br><span class="line">     &#125;</span><br><span class="line">	<span class="comment">/*</span><br><span class="line">	*操作数据</span><br><span class="line">	*/</span></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(file));</span><br><span class="line"> 		 data = (ArrayList&lt;T&gt;) ois.readObject();</span><br><span class="line"> 	<span class="comment">//	 data = (T) ois.readObject();</span></span><br><span class="line">     &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> data;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="1-编写Model涉及的知识点"><a href="#1-编写Model涉及的知识点" class="headerlink" title="1.编写Model涉及的知识点"></a>1.编写Model涉及的知识点</h3><blockquote>
<p>1.文件操作<br>2.输入输出流</p>
</blockquote>
<h3 id="2-文件操作编写思路"><a href="#2-文件操作编写思路" class="headerlink" title="2.文件操作编写思路"></a>2.文件操作编写思路</h3><blockquote>
<p>1.确定文件夹路径 - mkdirs<br>2.确定文件 - new File(dir,file);<br>3.操作数据 - ObjectInputStream/ObjectOutputStream</p>
</blockquote>
<h3 id="3-边缘处理"><a href="#3-边缘处理" class="headerlink" title="3.边缘处理"></a>3.边缘处理</h3><blockquote>
<p>1.确定文件夹路径时,除了需要判断是否存在该文件夹,还需判断是不是文件夹 - isDirectory<br>2.写数据到文件中时,需要清空原有数据。<br>3.写数据到文件中时,不需要createNewFile,因为输出流自动判断是否创建文件。<br>4.从文件中读数据时,需要判断文件是否存在,否则会报错。</p>
</blockquote>
<h1 id="图片缓存"><a href="#图片缓存" class="headerlink" title="图片缓存"></a>图片缓存</h1><p><a href="http://www.jianshu.com/p/2cd59a79ed4a" target="_blank" rel="external">图片的三级缓存</a><br><a href="http://blog.csdn.net/guolin_blog/article/details/28863651" target="_blank" rel="external">郭霖DiskLruCache分析</a></p>
<p><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/1209/2136.html" target="_blank" rel="external">APP本地缓存</a></p>


            <!-- Tags -->
            


<div class="tags">
    <a href="/tags/Android框架设计-APP缓存策略/">Android框架设计-APP缓存策略</a>
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>
</section><!-- end main -->

<!-- After footer scripts -->

<!-- jQuery -->
<script src="/js/jquery.js"></script>

<!-- Custom Code -->
<script src="/js/main.js"></script>

<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>