<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Build a better app.">
    

    <!--Author-->
    
        <meta name="author" content="TanJunDang">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="混淆"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="TanJunDang"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="undefined"/>
    

    <!-- Title -->
    
    <title>混淆 - TanJunDang</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!--Favicon-->
    

</head>

<body>

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">TanJunDang</a>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives">Archives</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
            
                <li><a href="https://www.facebook.com/" class="fb" target="_blank" data-title="Facebook"></a></li>
            
            
                <li><a href="https://www.behance.net/" class="behance" target="_blank" data-title="Behance"></a></li>
            
            
                <li><a href="https://plus.google.com/+Pixelhint/posts" class="google" target="_blank" data-title="Google+"></a></li>
            
            
                <li><a href="https://dribbble.com/pixelhint" class="dribble" target="_blank" data-title="Dribble"></a></li>
            
            
            
            
        </ul><!-- end social -->

        <div class="rights">
            <p>Copyright © 2014 magnetic.</p>
            <p>Template by <a href="http://pixelhint.com/magnetic-free-html5-responsive-photography-website-template/">Pixelhint.com</a></p>
            <p>Hexo Theme by <a href="http://www.codeblocq.com/">Jonathan K.</a></p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('http://placehold.it/1300x500');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a href="/2016/04/05/EventBus/" class="previous" data-title="EventBus学习笔记"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a href="/2016/03/31/OnTouchEvent/" class="next" data-title="事件分发机制onTouchEven..."></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">混淆</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h1 id="混淆目录"><a href="#混淆目录" class="headerlink" title="混淆目录"></a>混淆目录</h1><ul>
<li>Mapping（/project/app/build/outputs/mapping/）</li>
</ul>
<blockquote>
<p>dump.txt 描述apk文件中所有类文件间的内部结构。<br>mapping.txt 列出了原始的类，方法，和字段名与混淆后代码之间的映射。<br>seeds.txt 列出了未被混淆的类和成员<br>usage.txt 列出了从apk中删除的代码</p>
</blockquote>
<h1 id="ProGuard配置"><a href="#ProGuard配置" class="headerlink" title="ProGuard配置"></a>ProGuard配置</h1><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">生成mapping文件</span><br><span class="line">不能混淆的代码</span><br><span class="line">系统接口</span><br><span class="line">Jni接口</span><br><span class="line">其他如四大组件、View等</span><br><span class="line">第三方类库如android-support</span><br><span class="line"></span><br><span class="line">保留选项（配置不进行处理的内容）</span><br><span class="line"></span><br><span class="line">-keep &#123;Modifier&#125; &#123;class_specification&#125; 保护指定的类文件和类的成员 </span><br><span class="line">-keepclassmembers &#123;modifier&#125; &#123;class_specification&#125; 保护指定类的成员，如果此类受到保护他们会保护的更好 </span><br><span class="line">-keepclasseswithmembers &#123;class_specification&#125; 保护指定的类和类的成员，但条件是所有指定的类和类成员是要存在。 </span><br><span class="line">-keepnames &#123;class_specification&#125; 保护指定的类和类的成员的名称（如果他们不会压缩步骤中删除） </span><br><span class="line">-keepclassmembernames &#123;class_specification&#125; 保护指定的类的成员的名称（如果他们不会压缩步骤中删除） </span><br><span class="line">-keepclasseswithmembernames &#123;class_specification&#125; 保护指定的类和类的成员的名称，如果所有指定的类成员出席（在压缩步骤之后） </span><br><span class="line">-printseeds &#123;filename&#125; 列出类和类的成员-keep选项的清单，标准输出到给定的文件</span><br><span class="line"></span><br><span class="line">压缩</span><br><span class="line"></span><br><span class="line">-dontshrink 不压缩输入的类文件 </span><br><span class="line">-printusage &#123;filename&#125; </span><br><span class="line">-whyareyoukeeping &#123;class_specification&#125;</span><br><span class="line"></span><br><span class="line">优化</span><br><span class="line"></span><br><span class="line">-dontoptimize 不优化输入的类文件 </span><br><span class="line">-assumenosideeffects &#123;class_specification&#125; 优化时假设指定的方法，没有任何副作用 </span><br><span class="line">-allowaccessmodification 优化时允许访问并修改有修饰符的类和类的成员</span><br><span class="line"></span><br><span class="line">混淆</span><br><span class="line"></span><br><span class="line">-dontobfuscate 不混淆输入的类文件 </span><br><span class="line">-obfuscationdictionary &#123;filename&#125; 使用给定文件中的关键字作为要混淆方法的名称 </span><br><span class="line">-overloadaggressively 混淆时应用侵入式重载 </span><br><span class="line">-useuniqueclassmembernames 确定统一的混淆类的成员名称来增加混淆 </span><br><span class="line">-flattenpackagehierarchy &#123;package_name&#125; 重新包装所有重命名的包并放在给定的单一包中 </span><br><span class="line">-repackageclass &#123;package_name&#125; 重新包装所有重命名的类文件中放在给定的单一包中 </span><br><span class="line">-dontusemixedcaseclassnames 混淆时不会产生形形色色的类名 </span><br><span class="line">-keepattributes &#123;attribute_name,…&#125; 保护给定的可选属性，例如LineNumberTable, LocalVariableTable,SourceFile, Deprecated, Synthetic, Signature, and InnerClasses. </span><br><span class="line">-renamesourcefileattribute &#123;string&#125; 设置源文件中给定的字符串常量</span><br><span class="line"></span><br><span class="line">后面的文件名，类名，或者包名等可以使用占位符代替 </span><br><span class="line">？表示一个字符</span><br><span class="line"></span><br><span class="line">可以匹配多个字符，但是如果是一个类，不会匹配其前面的包名 </span><br><span class="line">可以匹配多个字符，会匹配前面的包名。  </span><br><span class="line">在android中在android Manifest文件中的activity，service，provider， receviter，等都不能进行混淆。一些在xml中配置的view也不能进行混淆，android提供的默认配置中都有</span><br></pre></td></tr></table></figure>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//实际开发中 开启混淆,打正式包后,可能会出现崩溃错误。这时需要通过mapping来查找错误。</span></span><br><span class="line"></span><br><span class="line">-optimizationpasses <span class="number">5</span>          # 指定代码的压缩级别</span><br><span class="line">-dontusemixedcaseclassnames   # 是否使用大小写混合</span><br><span class="line">-dontpreverify           # 混淆时是否做预校验</span><br><span class="line">-verbose                # 混淆时是否记录日志</span><br><span class="line"></span><br><span class="line">-dontwarn com.umeng.**</span><br><span class="line">#保持com.umeng.**这个包里面的所有类和所有方法不被混淆。(没有友盟的集成时删除此句)</span><br><span class="line"></span><br><span class="line"># 混淆时所采用的算法</span><br><span class="line">-optimizations !code<span class="regexp">/simplification/</span>arithmetic,!field<span class="comment">/*,!class/merging/*</span><br><span class="line"></span><br><span class="line"> # 保持哪些类不被混淆</span><br><span class="line">-keep public class * extends android.app.Application</span><br><span class="line">-keep public class * extends android.app.Service</span><br><span class="line">-keep public class * extends android.content.BroadcastReceiver</span><br><span class="line">-keep public class * extends android.content.ContentProvider</span><br><span class="line">-keep public class * extends android.app.backup.BackupAgentHelper</span><br><span class="line">-keep public class * extends android.preference.Preference</span><br><span class="line">-keep public class com.android.vending.licensing.ILicensingService</span><br><span class="line"></span><br><span class="line"> # 保持 native 方法不被混淆</span><br><span class="line">-keepclasseswithmembernames class * &#123;</span><br><span class="line">    native &lt;methods&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> # 保持自定义控件类不被混淆</span><br><span class="line">-keepclasseswithmembers class * &#123;</span><br><span class="line">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);</span><br><span class="line">&#125;</span><br><span class="line">-keepclasseswithmembers class * &#123;# 保持自定义控件类不被混淆</span><br><span class="line">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);</span><br><span class="line">&#125;</span><br><span class="line">-keepclassmembers class * extends android.app.Activity &#123;  # 保持自定义控件类不被混淆</span><br><span class="line">    public void *(android.view.View);</span><br><span class="line">&#125;</span><br><span class="line">-keepclassmembers enum * &#123;     # 保持枚举 enum 类不被混淆</span><br><span class="line"> public static **[] values();</span><br><span class="line"> public static ** valueOf(java.lang.String);</span><br><span class="line">&#125;</span><br><span class="line">-keep class * implements android.os.Parcelable &#123; # 保持 Parcelable 不被混淆</span><br><span class="line"> public static final android.os.Parcelable$Creator *;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-keep class io.movies.common.entity.** &#123; *; &#125;  #实体类不参与混淆 </span><br><span class="line"></span><br><span class="line">#gson混淆代码</span><br><span class="line">#-libraryjars libs/gson-2.3.1.jar</span><br><span class="line">-keepattributes Signature</span><br><span class="line"># Gson specific classes</span><br><span class="line">-keep class sun.misc.Unsafe &#123; *; &#125;</span><br><span class="line"># Application classes that will be serialized/deserialized over Gson</span><br><span class="line">-keep class com.google.gson.examples.android.model.** &#123; *; &#125;</span><br><span class="line"></span><br><span class="line">#-printmapping mapping.txt //激活这句代码会导致不生成mapping文件</span></span><br></pre></td></tr></table></figure>
<h1 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h1><blockquote>
<p>错误 - Unable to compute hash of /../AndroidStudioProjects/../classes.jar错误<br>说明在打包混淆的时候需要keep一些文件，让他们不要被混淆。</p>
<p>解决办法：<br>加上-dontskipnonpubliclibraryclasses #不混淆第三方库</p>
<p>错误 - 没生成mapping</p>
<p>原因<br>minifyEnable true 开启混淆模式</p>
<p>解决方法<br>配置-ignorewarnings #生成mapping文件</p>
<h2 id="printmapping-mapping-txt-混淆文件没有删除这句代码"><a href="#printmapping-mapping-txt-混淆文件没有删除这句代码" class="headerlink" title="-printmapping mapping.txt 混淆文件没有删除这句代码"></a>-printmapping mapping.txt 混淆文件没有删除这句代码</h2></blockquote>
<h1 id="混淆后出问题"><a href="#混淆后出问题" class="headerlink" title="混淆后出问题"></a>混淆后出问题</h1><blockquote>
<p>解决方法：找到相关位置,对未混淆的类进行混淆。</p>
<p><a href="http://www.bkjia.com/Androidjc/995232.html" target="_blank" rel="external">混淆参考</a><br><a href="http://my.oschina.net/sammy1990/blog/271306?fromerr=Ww2DepNa#OSC_h4_2" target="_blank" rel="external">混淆参考</a></p>
</blockquote>


            <!-- Tags -->
            


<div class="tags">
    <a href="/tags/混淆/">混淆</a>
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>
</section><!-- end main -->

<!-- After footer scripts -->

<!-- jQuery -->
<script src="/js/jquery.js"></script>

<!-- Custom Code -->
<script src="/js/main.js"></script>

<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>