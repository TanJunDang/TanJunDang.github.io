<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

    <!--Description-->
    
        <meta name="description" content="Build a better app.">
    

    <!--Author-->
    
        <meta name="author" content="TanJunDang">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Socket学习笔记"/>
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="TanJunDang"/>

    <!--Page Cover-->
    
        <meta property="og:image" content="undefined"/>
    

    <!-- Title -->
    
    <title>Socket学习笔记 - TanJunDang</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!--Favicon-->
    

</head>

<body>

<!-- Menu -->
<!-- Navigation -->
<header>
    <div class="logo">
        <a href="/">TanJunDang</a>
    </div><!-- end logo -->

    <div id="menu_icon"></div>
    <nav>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives">Archives</a>
            </li>
            
        </ul>
    </nav><!-- end navigation menu -->

    <div class="footer clearfix">
        <ul class="social clearfix">
            
            
                <li><a href="https://www.facebook.com/" class="fb" target="_blank" data-title="Facebook"></a></li>
            
            
                <li><a href="https://www.behance.net/" class="behance" target="_blank" data-title="Behance"></a></li>
            
            
                <li><a href="https://plus.google.com/+Pixelhint/posts" class="google" target="_blank" data-title="Google+"></a></li>
            
            
                <li><a href="https://dribbble.com/pixelhint" class="dribble" target="_blank" data-title="Dribble"></a></li>
            
            
            
            
        </ul><!-- end social -->

        <div class="rights">
            <p>Copyright © 2014 magnetic.</p>
            <p>Template by <a href="http://pixelhint.com/magnetic-free-html5-responsive-photography-website-template/">Pixelhint.com</a></p>
            <p>Hexo Theme by <a href="http://www.codeblocq.com/">Jonathan K.</a></p>
        </div><!-- end rights -->
    </div ><!-- end footer -->
</header><!-- end header -->


<!-- Main Content -->
<section class="main clearfix">

    <section class="top" style="background: url('http://placehold.it/1300x500');">
        <div class="wrapper content_header clearfix">
            

<div class="work_nav">

    <ul class="btn clearfix">
        
        <li><a href="/2016/11/03/Camera/" class="previous" data-title="Camera学习笔记"></a></li>
        
        <li><a href="/" class="grid" data-title="Portfolio"></a></li>
        
        <li><a href="/2016/10/22/ScrollView/" class="next" data-title="ScrollView学习笔记"></a></li>
        
    </ul>

</div><!-- end work_nav -->
            <h1 class="title">Socket学习笔记</h1>
        </div>
    </section><!-- end top -->

    <section class="wrapper">
        <div class="content">

            <!-- Gallery -->
            

            <!-- Content -->
            <h1 id="Socket基础知识"><a href="#Socket基础知识" class="headerlink" title="Socket基础知识"></a>Socket基础知识</h1><blockquote>
<p>Socket用于客户端与服务端间进行网络通信。包括连接服务器、发送接收数据、关闭网络连接的功能。<br>Socket适用于长时间连接。<br>每个客户端Socket都必须要用新的线程进行处理。<br>在Android，可通过AsyncTask线程来处理Socket。<br><a id="more"></a></p>
</blockquote>
<h2 id="Socket通信步骤"><a href="#Socket通信步骤" class="headerlink" title="Socket通信步骤"></a>Socket通信步骤</h2><blockquote>
<p>1.客户端连接服务器 - 连接方式分构造函数、connect方法两种。<br>2.客户端与服务器间相互发送和接收数据 - 涉及Out(In)putStream、BufferWriter(Reader)读取流的方式。<br>3.关闭连接 - 调用各种流的close方法。</p>
</blockquote>
<h2 id="Socket的连接方式"><a href="#Socket的连接方式" class="headerlink" title="Socket的连接方式"></a>Socket的连接方式</h2><blockquote>
<p>Socket连接服务端的方式分为构造函数、connect方法两种。<br>下面通过两种方式来实现客户端向服务端发送数据，服务端将其打印出来的功能。</p>
</blockquote>
<h2 id="网络连接超时"><a href="#网络连接超时" class="headerlink" title="网络连接超时"></a>网络连接超时</h2><table>
<thead>
<tr>
<th>网络连接超时</th>
<th>说明</th>
<th>相关方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>连接超时</td>
<td>在规定时间内，客户端与服务器仍未建立连接，导致超时异常</td>
<td>connect(InetAddress address, int timeout)</td>
</tr>
<tr>
<td>读取超时</td>
<td>在规定时间内，仍未读取到数据，导致超时异常</td>
<td>setTimeOut(x) x单位毫秒</td>
</tr>
</tbody>
</table>
<blockquote>
<p>读取超时需要在绑定IP、端口之前设置才有效。<br>客户端若不设置读取超时,则使用服务器中的超时时间。</p>
</blockquote>
<h3 id="示例-构造函数方式"><a href="#示例-构造函数方式" class="headerlink" title="示例 - 构造函数方式"></a>示例 - 构造函数方式</h3><blockquote>
<p>Socket(String host , int port)//参数分别服务端主机地址、端口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SocketThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      Socket socket;</span><br><span class="line">      BufferedWriter bw;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">               socket = <span class="keyword">new</span> Socket(<span class="string">"192.168.0.50"</span>, <span class="number">4000</span>);</span><br><span class="line">              <span class="comment">// socket = new Socket();</span></span><br><span class="line">              <span class="comment">// socket.connect(new InetSocketAddress("192.168.0.50", 4000));</span></span><br><span class="line">              <span class="comment">// bw = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));</span></span><br><span class="line">              <span class="comment">// bw.write("TanJunDang.github.io\nDeveloper:TanJunDang\nEmail:TanJunDang324@gmail.com\n");</span></span><br><span class="line">              <span class="comment">// bw.flush();</span></span><br><span class="line">          &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="示例-connect方法"><a href="#示例-connect方法" class="headerlink" title="示例 - connect方法"></a>示例 - connect方法</h3><blockquote>
<p>使用connect方法必须通过Socket的无参构造函数来创建对象。<br>connect(SocketAddress add)//参数为SocketAddress,该类封装了主机地址以及端口<br>connect(SocketAddress add ,int timeout)//第二个参数是超时参数、默认为0</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SocketThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      Socket socket;</span><br><span class="line">      BufferedWriter bw;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              socket = <span class="keyword">new</span> Socket();</span><br><span class="line">              socket.setTimeOut(<span class="number">1000</span>);<span class="comment">//设置读取超时</span></span><br><span class="line">              socket.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"192.168.0.50"</span>, <span class="number">4000</span>));</span><br><span class="line">							<span class="comment">// bw = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));</span></span><br><span class="line">							<span class="comment">// bw.write("TanJunDang.github.io\nDeveloper:TanJunDang\nEmail:TanJunDang324@gmail.com\n");</span></span><br><span class="line">							<span class="comment">// bw.flush();</span></span><br><span class="line">          &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Socket常用的方法"><a href="#Socket常用的方法" class="headerlink" title="Socket常用的方法"></a>Socket常用的方法</h2><table>
<thead>
<tr>
<th>Socket常用方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>isClosed()</td>
<td>判断Socket对象是否处于关闭状态 <br> true - 关闭 false - 连接</td>
</tr>
<tr>
<td>isConnected()</td>
<td>判断Socket对象是否成功连接过 <br></td>
</tr>
<tr>
<td>(!isClosed() &amp;&amp; isConnected())</td>
<td>判断socket对象是否处于连接状态</td>
</tr>
<tr>
<td>getInetAddress()</td>
<td>返回一个InetAddress对象，通过该对象可获取服务器IP，Port等信息</td>
</tr>
<tr>
<td>getLocalAddress()</td>
<td>返回一个InetAddress对象，通过该对象可获取本机的IP，port等信息</td>
</tr>
<tr>
<td>getInputStream()、getOutputStream()</td>
<td>输入输出流，用于接收和发送数据</td>
</tr>
<tr>
<td>setReuseAddress(boolean on)</td>
<td>当多个socket绑定一个端口时，需要调用setReuseAddress(true),否则会出Bind异常</td>
</tr>
<tr>
<td>setSoLinger(boolean on,int linger)</td>
<td>当socket关闭时，若还没有发送完数据，则阻塞linger秒，从而尽量把数据发完</td>
</tr>
<tr>
<td>setTimeOut(int timeout)</td>
<td><font color="#1abc9c">设置读取数据超时，单位毫秒，读取数据前调用</font></td>
</tr>
<tr>
<td>setKeepAlive(boolean on)</td>
<td>该方法用于检测Socket是否处于活动状态，客户端Socket每隔一段时间利用空闲的时间向服务器发送一个检测数据包，如果服务器未响应该数据包，在几分钟后，客户端socket再发一个数据包，若服务器还没响应，则客户端Socket关闭。</td>
</tr>
</tbody>
</table>
<p><a href="http://blog.csdn.net/swingline/article/details/5357581" target="_blank" rel="external">readLine方法的理解</a></p>
<h1 id="ServerSocket基础知识"><a href="#ServerSocket基础知识" class="headerlink" title="ServerSocket基础知识"></a>ServerSocket基础知识</h1><blockquote>
<p>服务端Socket操作步骤<br>1.while循环接收客户端socket。<br>2.为每个socket建立一条线程。线程用于处理接收和发送消息。<br>3.创建线程管理类，管理所有客户端线程，使其相互间能通信。</p>
</blockquote>
<h1 id="示例-简单聊天系统"><a href="#示例-简单聊天系统" class="headerlink" title="示例 - 简单聊天系统"></a>示例 - 简单聊天系统</h1><h1 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h1><h2 id="客户端连接上服务器，但不执行run方法。"><a href="#客户端连接上服务器，但不执行run方法。" class="headerlink" title="客户端连接上服务器，但不执行run方法。"></a>客户端连接上服务器，但不执行run方法。</h2><blockquote>
<p>接收客户端socket时处理不正常。示例代码如下</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//错误代码</span></span><br><span class="line">Socket socket;</span><br><span class="line">ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">4000</span>);</span><br><span class="line"><span class="keyword">while</span> (serverSocket.accept() != <span class="keyword">null</span>) &#123;</span><br><span class="line">socket = serverSocket.accept() ;</span><br><span class="line"><span class="comment">//客户端socket相关处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分析<br>由于accept是阻塞方法,上面两次调用了accept方法，阻塞导致客户端连接不成功。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//正确代码</span></span><br><span class="line">Socket socket;</span><br><span class="line">ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">4000</span>);</span><br><span class="line"><span class="keyword">while</span> ((socket = serverSocket.accept()) != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">//客户端socket相关处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connect failed: ECONNREFUSED (Connection refused)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可能原因：客户端端口跟服务端端口不一致。</p>
</blockquote>


            <!-- Tags -->
            


<div class="tags">
    <a href="/tags/Socket学习笔记/">Socket学习笔记</a>
</div>



            <!-- Comments -->
            <div>
                




            </div>
        </div><!-- end content -->
    </section>
</section><!-- end main -->

<!-- After footer scripts -->

<!-- jQuery -->
<script src="/js/jquery.js"></script>

<!-- Custom Code -->
<script src="/js/main.js"></script>

<!-- Gallery -->
<script src="//cdn.rawgit.com/noelboss/featherlight/1.3.5/release/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->


</body>

</html>